{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/WriterProfile.css' %}">
    <!-- SweetAlert2 CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<!-- SweetAlert2 JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="{% static 'js/script.js' %}"></script> 

    <title>Reader Profile Page</title>
    <style>
        .comments-section {
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .h3-design {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .comment-input {
            border-radius: 4px;
            border: 1px solid #ddd;
            padding: 10px;
        }
        
        .post-button {
            border-radius: 4px;
        }
        
        .comment-card {
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .comment-actions {
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }
        
        .comment-form {
            display: flex;
            flex-direction: column;
        }
        
        .comment-textarea {
            border-radius: 4px;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            resize: none;
        }
        
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
            color: #fff;
        }
        
        .comment-card .comment {
            background-color: #fff;
            border-radius: 4px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .comment-header {
            margin-bottom: 10px;
        }
        
        .comment-author {
            font-weight: bold;
            margin: 0;
        }
        
        .comment-text {
            margin: 0;
        }
        
        .delete-comment-form {
            display: inline;
        }
        
        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
            color: #fff;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        /* Card Styles */
        .cute-card {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 10%;
        }
        
        .cute-card .card-header {
            background-color: #24333B; /* Lighter gray header */
            color: #ffffff;
            font-weight: bold;
            text-align: center;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            font-size: 50px;
        }
        
        /* Table Styles */
        .cute-table {
            margin-top: 20px;
            width: 100%;
            
        }
        
        .cute-table thead {
            background-color: #C0C0C0;
            color: #ffffff;
            font-weight: bold;
            text-align: center;
        }
        
        .cute-table th, .cute-table td {
            padding: 12px 15px;
            text-align: center;
            color: #24333B;
        }
        
        .cute-table tr:hover {
            background-color: #f1f1f1;
        }
        
        /* Links */
        .cute-link {
            color: #24333B;
            text-decoration: none;
            font-weight: bold;
        }
        
        .cute-link:hover {
            color: #4a42d1;
            text-decoration: underline;
        }
        
        /* Button Styles */
        .cute-button {
            background-color: #24333B;
            color: #ffffff;
            border-radius: 20px;
            padding: 10px 20px;
            font-family: 'Comic Sans MS', sans-serif;
            font-size: 16px;
            border: none;
            transition: background-color 0.3s ease;
            margin-top: 10px;
        }
        
        .cute-button:hover {
            background-color: #d0d0d0;
        }
        
        .create-link {
            color: #ffffff;
            text-decoration: none;
        }
        .h3-design{
        font-size: 55px;
        }
    </style>
</head>
<body>
<header>
    {% comment %} <button class="btn btn-primary"><a class= "create" href="{%url 'create_book'%}">Create Book</a></button> {% endcomment %}

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand text-white" href="{% url 'home' %}"><img src="{%static 'image/logo.png'%}" width="80" > Reading & Writing Books</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
            <ul class="navbar-nav mx-auto">
                <li class="nav-item mx-2">
                    <a class="nav-link text-white" href="{% url 'home' %}">Home <span class="sr-only">(current)</span></a>
                
                <li class="nav-item mx-2">
                    <a class="nav-link text-white" href="{% url 'writer_home_page' %}">Writer Home page</a>
                </li>
            </li>
            <li class="nav-item mx-2">
                <input type="search" name="search" class="form-control" placeholder="Search">
            </li>
                <li class="nav-item mx-2">
                    <a class="nav-link text-white" href="{% url 'writer_profile' %}">Profile</a>
                </li>
                <li class="nav-item mx-2">
                    <a class="nav-link text-white" href="{% url 'about_us' %}">About Us</a>
                </li>
            </ul>
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link text-white" href="{% url 'home' %}">Sign out</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="profile-header">
            <img src="https://img.freepik.com/premium-photo/animated-girl-cartoon-character-generated-ai_652383-2311.jpg?ga=GA1.1.209331547.1723160267&semt=ais_hybrid" alt="user image">
            <div>
                <a href="{%url 'edit_writer_profile' user.id %}" class="btn btn-link">Edit Profile</a>
                <h3>{{user.first_name}} {{user.last_name}}</h3>
            </div>
        </div>
        
        <div>
            <h3 class="mt-4">Bio</h3>
            <p>{{user.bio}}</p>
        </div>
        <hr>
    </div>
</header>

<main class="container">
    <div class="row">
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">Books Library</h2>
                    {%for book in book%}
                    <ul class="book">
                        <li><a href="{%url 'view_book' book.id %}">{{book.title}}</a></li>
                        {% comment %} <li>Book 2</li>
                        <li>Book 3</li>
                        <li>Book 4</li>
                        <li>Book 5</li> {% endcomment %}
                    </ul>
                    {%endfor%}
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">Book Categories</h2>
                    {%for book in book%}
                    <ul class="category">
                        <li><a href="{%url 'view_book' book.id %}">{{book.genre}}</a></li>
                        {% comment %} <li>Category 2</li>
                        <li>Category 3</li>
                        <li>Category 4</li>
                        <li>Category 5</li> {% endcomment %}
                    </ul>
                    {%endfor%}
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">Daily Book Review</h2>
                    <img src="https://alibrarymama.com/wp-content/uploads/2021/01/2020-summary.png" class="graph-image">
                </div>
            </div>
        </div>
    </div>
</main>
{% comment %} <div class="input-group mb-3">
            <form method="POST" action="{% url 'create_posts' %}">
                {% csrf_token %}
                <div class="input-group mb-3">
                    <textarea type="text" class="form-control" name="content" placeholder="Write a post..." aria-label="Write a post" aria-describedby="button-addon2" cols="100"></textarea>
                    <button class="btn btn-dark" type="button" id="button-addon2">Post</button>
                </div>
            </form>
        </div> {% endcomment %}
<section class="container">
    <div class="comments-section">
        <h3 class="h3-design text-xl-center">My Posts</h3>
        
        <div class="comments-list">
            {% for post in post %}
            <div class="comment-card card mb-3">
                <div class="card-body">
                    <p class="card-text ">Posted by {{ post.user.username }} on {{ post.created_at }}</p><br>
                    
                    <p class="card-text">{{ post.content }}</p>
                    <form action="{% url 'delete_post' post.id %}" method="POST" class="delete-comment-form" id="display-data">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </div>
                <div class="comment-actions mt-4">
                    <form action="{% url 'post_comment' post.id %}" method="POST" class="comment-form">
                        {% csrf_token %}
                        <textarea class="comment-textarea" name="content" placeholder="Type your comment here"></textarea>
                        <button type="submit" class="btn btn-dark">Post a Comment</button>
                    </form>
                    <div class="comments mt-4">
                        {% for comment in post.comments.all %}
                        <div class="comment card p-3 mb-2" id="comment-{{ comment.id }}">
                            <div class="comment-header d-flex justify-content-between">
                                <p class="comment-author">{{ comment.user.first_name }} - {{ comment.created_at }}</p>
                                <form action="{% url 'delete_comment' comment.id %}" method="POST" class="delete-comment-form" data-comment-id="{{ comment.id }}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                </form>
                            </div>
                            <p class="comment-text">{{ comment.content }}</p>
                        </div>
                        {% comment %} <div class="comment card p-3 mb-2">
                            <div class="comment-header d-flex justify-content-between">
                                <p class="comment-author">{{ comment.user.first_name }} - {{ comment.created_at }}</p>
                                <form action="{% url 'delete_comment' comment.id %}" method="POST" class="delete-comment-form">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                </form>
                            </div>
                            <p class="comment-text">{{ comment.content }}</p>
                        </div> {% endcomment %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div> 
<div class="tables-container mt-4">
    <!-- Books Section -->
    <div class="card cute-card">
        <div class="card-header cute-title">
            Books
        </div>
        <div class="card-body">
            <table class="table cute-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Book Genre</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in book %}
                    <tr>
                        <td><a href="{% url 'view_book' book.id %}" class="cute-link">{{ book.title }}</a></td>
                        <td>{{ book.genre }}</td>
                        <td>{{ book.description }}</td>
                        <td class="col-2"><a href="{% url 'edit_book' book.id %}" class="cute-link">Edit</a> | <button type="button" class="btn btn-danger btn-sm delete-button" data-url="{% url 'delete_book' book.id %}">Delete</button></td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4">
                            <button class="btn cute-button"><a href="{% url 'create_book' %}" class="create-link ">Create Book</a></button>
                        </td>
                    </tr>
                </tfoot>
            </table>
            {% comment %} <button class="btn cute-button"><a href="{% url 'create_book' %}" class="create-link">Create Book</a></button> {% endcomment %}

        </div>
    </div>
    
        <!-- Events Section -->
        <div class="card cute-card mt-4">
            <div class="card-header cute-title">
                Events
            </div>
            <div class="card-body">
                <table class="table cute-table">
                    <thead>
                        <tr>
                            <th>Event Name</th>
                            <th>Event Date</th>
                            <th>Event content</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in event %}
                        <tr>
                            <td><a href="{% url 'view_event' event.id %}" class="cute-link">{{ event.event_name }}</a></td>
                            <td>{{ event.event_date }}</td>
                            <td>{{ event.event_content }}</td>
                            <td class="col-2"><a href="{% url 'edit_event' event.id %}" class="cute-link">Edit</a> | <button type="button" class="btn btn-danger btn-sm delete-button" data-url="{% url 'delete_event' event.id %}">Delete</button>></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4">
                                <button class="btn cute-button"><a href="{% url 'create_event' %}" class="create-link ">Create Event</a></button>
                            </td>
                        </tr>
                    </tfoot>
                </table>
                {% comment %} <button class="btn cute-button"><a href="{% url 'create_event' %}" class="create-link ">Create Event</a></button> {% endcomment %}
            </div>
        </div>
    
        <!-- Book Club Section -->
        <div class="card cute-card mt-4">
            <div class="card-header cute-title">
                Book Club
            </div>
            <div class="card-body">
                <table class="table cute-table">
                    <thead>
                        <tr>
                            <th>Book Club Name</th>
                            <th>Book Club Content</th>
                            <th>Book Club Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for book_club in book_club %}
                        <tr>
                            <td><a href="{% url 'view_book_club' book_club.id %}" class="cute-link">{{ book_club.club_name }}</a></td>
                            <td>{{ book_club.club_content }}</td>
                            <td>{{ book_club.club_type }}</td>
                            <td class="col-2"><a href="{% url 'edit_book_club' book_club.id %}" class="cute-link">Edit</a> | <button type="button" class="btn btn-danger btn-sm delete-button" data-url="{% url 'delete_book_club' book_club.id %}">Delete</button></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4">
                                <button class="btn cute-button"><a href="{% url 'create_book_club' %}" class="create-link ">Create Book Club</a></button>
                            </td>
                        </tr>
                    </tfoot>
                </table>
                {% comment %} <button class="btn cute-button"><a href="{% url 'create_book_club' %}" class="create-link ">Create Book Club</a></button> {% endcomment %}
            </div>
        </div>
    </div>
    {% comment %}{% url 'edit_book_club' book_club.id %} {% url 'view_book_club' book_club.id %}{% url 'delete_book_club' book_club.id %} {% endcomment %}

</section>

<footer class="bg-dark text-white text-center text-lg-start mt-4">
    <h3 class="p-3 bg-secondary">Reading & Writing Books</h3>
    <div class="container p-4">
        <div class="row">
            <div class="col-lg-6 col-md-12 mb-4 mb-md-0">
                <h5 class="text-uppercase">Contact</h5>
                <ul class="list-unstyled mb-0">
                    <li>
                        <a href="mailto:contact@readingwritingbooks.com" class="text-white">Email: contact@readingwritingbooks.com</a>
                    </li>
                    <li>
                        <a href="tel:+972321456897" class="text-white">Phone: +972 321 456 897</a>
                    </li>
                    <li>
                        <a href="#" class="text-white">Address: Palestine, Ramallah</a>
                    </li>
                </ul>
            </div>
            <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                <h5 class="text-uppercase">Company</h5>
                <ul class="list-unstyled mb-0">
                    <li>
                        <a href="#" class="text-white">About Us</a>
                    </li>
                    <li>
                        <a href="#" class="text-white">Privacy Policy</a>
                    </li>
                    <li>
                        <a href="#" class="text-white">Terms of Service</a>
                    </li>
                </ul>
            </div>
            <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                <h5 class="text-uppercase">Follow Us</h5>
                <ul class="list-unstyled mb-0">
                    <li>
                        <a href="#" class="text-white">Facebook</a>
                    </li>
                    <li>
                        <a href="#" class="text-white">Twitter</a>
                    </li>
                    <li>
                        <a href="#" class="text-white">Instagram</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
{% comment %} <div class="custom-shape-divider-bottom-1723142584">
    <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
        <path d="M1200,0H0V120H281.94C572.9,116.24,602.45,3.86,602.45,3.86h0S632,116.24,923,120h277Z" class="shape-fill"></path>
    </svg>
</div> {% endcomment %}

<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: 'btn btn-success',
                cancelButton: 'btn btn-danger'
            },
            buttonsStyling: false
        });
    
        document.querySelectorAll('button.delete-button').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const url = this.getAttribute('data-url');
                const row = this.closest('tr'); // Find the closest table row
    
                swalWithBootstrapButtons.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'No, cancel!',
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch(url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value // CSRF token
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                row.remove(); // Remove the row from the table
                                swalWithBootstrapButtons.fire({
                                    title: 'Deleted!',
                                    text: 'Your file has been deleted.',
                                    icon: 'success'
                                });
                            } else {
                                swalWithBootstrapButtons.fire({
                                    title: 'Error!',
                                    text: 'Something went wrong.',
                                    icon: 'error'
                                });
                            }
                        })
                        .catch(error => {
                            swalWithBootstrapButtons.fire({
                                title: 'Error!',
                                text: 'Something went wrong.',
                                icon: 'error'
                            });
                        });
                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                        swalWithBootstrapButtons.fire({
                            title: 'Cancelled',
                            text: 'Your imaginary file is safe :)',
                            icon: 'error'
                        });
                    }
                });
            });
        });
    });
    </script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        $(document).ready(function() {
            // Handle comment form submission
            $('.comment-form').on('submit', function(event) {
                event.preventDefault(); // Prevent default form submission
                
                var $form = $(this);
                var postId = $form.closest('.comment-card').data('post-id'); // Get the post ID
                var formData = $form.serialize();
                
                $.ajax({
                    url: $form.attr('action'),
                    type: 'POST',
                    data: formData,
                    success: function(response) {
                        // Append the new comment to the comments section
                        var newCommentHtml = response.html;
                        $('#comments-' + postId).append(newCommentHtml); // Add new comment to the post
                        
                        // Clear the form textarea
                        $form.find('textarea').val('');
                        
                        // Show success message
                        Swal.fire({
                            title: 'Success!',
                            text: 'Comment added successfully!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                    },
                    error: function(xhr) {
                        // Show error message
                        Swal.fire({
                            title: 'Error!',
                            text: 'Error adding comment: ' + xhr.responseText,
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                    }
                });
            });
        
            // Handle post delete
            $('.delete-comment-form[data-post-id]').on('submit', function(event) {
                event.preventDefault(); // Prevent default form submission
                
                var $form = $(this);
                var postId = $form.data('post-id');
                
                Swal.fire({
                    title: 'Are you sure?',
                    text: 'You won\'t be able to revert this!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#85d630',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: $form.attr('action'),
                            type: 'POST',
                            data: $form.serialize(),
                            success: function() {
                                $('#post-' + postId).remove(); // Remove post element
                                Swal.fire(
                                    'Deleted!',
                                    'Your post has been deleted.',
                                    'success'
                                );
                            },
                            error: function(xhr) {
                                Swal.fire(
                                    'Error!',
                                    'Error deleting post: ' + xhr.responseText,
                                    'error'
                                );
                            }
                        });
                    }
                });
            });
        
            // Handle comment delete
            $('.delete-comment-form[data-comment-id]').on('submit', function(event) {
                event.preventDefault(); // Prevent default form submission
                
                var $form = $(this);
                var commentId = $form.data('comment-id');
                
                Swal.fire({
                    title: 'Are you sure?',
                    text: 'You won\'t be able to revert this!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#85d630',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: $form.attr('action'),
                            type: 'POST',
                            data: $form.serialize(),
                            success: function() {
                                $('#comment-' + commentId).remove(); // Remove comment element
                                Swal.fire(
                                    'Deleted!',
                                    'Your comment has been deleted.',
                                    'success'
                                );
                            },
                            error: function(xhr) {
                                Swal.fire(
                                    'Error!',
                                    'Error deleting comment: ' + xhr.responseText,
                                    'error'
                                );
                            }
                        });
                    }
                });
            });
        });
        </script>


</body>
</html>